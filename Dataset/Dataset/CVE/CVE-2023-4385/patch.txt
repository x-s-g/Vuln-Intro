@@ -388,7 +388,8 @@ int dbFree(struct inode *ip, int blkno, int nblocks)
 	}
 
 	/* write the last buffer. */
-	write_metapage(mp);
+	if (mp)
+		write_metapage(mp);
 
 	IREAD_UNLOCK(ipbmap);
 
